Fir 语言设计概要
==================

Fir语言设计的目的是作为一款可以编译也可以速执行的嵌入式语言
能够方便地嵌入各种平台环境, 类似于lua, 但同时又提供非常好的jit支持

做法是这样的, 首先用C++编写一套Runtime运行时, 将脚本读入并进行语法分析, 得出语法树, 提供基本的C函数调用功能
之后就开始实现自举, 用脚本来编写编译器的核心部分

这个项目我想验证脚本语言是否也能实现自举，能否拥有和编译型语言同样高效的运行能力

项目思路有点像Lisp，先实现一个极简的子集，然后用这个子集迭代构建lisp语言的解释器

## 核心功能

能够原生调用C函数, 实现和C/C++混编, 无需对C代码进行任何修改。
语法层支持先进的宏系统，能够对各种自定义语法进行展开，还能用自己的语言对宏展开的算法进行自定义
混合了编译时和运行时，这两者没有明显的界限，但实际上却在内部进行了很好的规划，使得脚本的编译成为可能
编译时代码若被运行时代码调用，则可以通过打包解释器包实现

## 整体结构

首先入口有两个，一个是编译当前包，一个就是直接解释执行

先说解释执行的逻辑，解析执行代码会被做成一组完整的C函数接口，这时只需调用解析执行即可，同时为解析器设置好当前的环境变量，工作目录，编译器配置等信息。

代码解析执行分三步，一是先解析，二是代码生成bc文件并缓存，然后交由jit执行

一份代码的解析过程又可以细分为五步，扫描宏定义，展开宏，扫描类型，扫描方法定义，扫描方法。

对于任何一个作用域下的扫描都可以分为这三步，这种方法也适用于函数内嵌套定义函数。

遇到import时，立即递归执行，在第一次预处理扫描时就进行递归扫描，获取对需要import的包进行整体编译

index.fir 是包的导入文件，如果里面是import "." 则导入当前目录下的全部，也可以用来在包导入时做些处理工作
import "." as C;    则导入符号到符号C下面

如何处理交叉依赖，a import b, b 又import a时



## 添加JIT设计

JIT是本系统非常复杂的一部分，必须能够支持即时导入新的代码，以及维护代码更新

由于LLVM本身是由模块组织的，和我们的模型设计不大一样，所以很多流程需要特别设计

这里，一个文件对应两个module，一个代码，一个元数据



## 内建环境变量

__dir 是当前的目录
__file 是当前的文件名
__env 是当前的环境变量
__export 是导出的变量映射表
__meta 是当前文件的


## 编译的包的临时缓存

在其目录的 `.fir_cache` 目录下，`meta`下是每个文件的meta信息 `obj`下是编译后的